import streamlit as st
import os
import time
from PIL import Image

st.write("Image Gallery")

# Define path to aibo's photo folder (source) and static folder 
source_folder = 'C:/Users/advik/Data/MS/New_York_Institute_of_Technology/RA_SoAD/Project2/WebApp/output_pics'

# @st.cache(allow_output_mutation=True)
def get_latest_image(source_folder):
    # Get a list of file names in the source folder
    file_names = os.listdir(source_folder)
    if not file_names:
        # Return None if the directory is empty
        return None
    # Sort the file names based on the modification time
    file_names.sort(key=lambda x: os.path.getctime(os.path.join(source_folder, x)), reverse=True)
    # Return the latest file name
    return file_names[0]


while True:
    latest_filename = get_latest_image(source_folder)
    if latest_filename is not None:
        # Display the latest image
        st.image(Image.open(os.path.join(source_folder, latest_filename)), caption=latest_filename)

        # Check for changes in the directory every 5 seconds
        new_filename = get_latest_image(source_folder)
        if new_filename != latest_filename:
            st.experimental_rerun()

    try:
        # Wait for 5 seconds before checking for changes again
        time.sleep(5)
    except KeyboardInterrupt:
        # Exit the loop if the user presses Ctrl+C
        break

